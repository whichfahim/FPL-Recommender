# FPL Scout — Gameweek Intelligence

A Fantasy Premier League player recommendation system that fetches live data from the official FPL API, scores every available player using a configurable weighted algorithm, and presents ranked recommendations in an interactive dashboard.

The project has two components: a **Python script** (`fpl_scout.py`) that fetches and exports data locally, and an **HTML dashboard** (`fpl-recommender.html`) that visualises and re-scores players in real time.

---

## Getting Started

### Option A — Use the Dashboard (no install)

Open `fpl-recommender.html` in any modern browser. Load data via one of three methods:

1. **Fetch Live Data** — the dashboard tries several CORS proxies to hit the FPL API directly. Works when a proxy is available.
2. **Load CSV** — drag and drop (or browse for) a `fpl_scout_gw*.csv` file generated by the Python script.
3. **Demo Data** — loads a built-in sample dataset so you can explore the interface immediately.

### Option B — Run the Python Script

Fetches data directly from the FPL API (no CORS issues) and exports a CSV you can load into the dashboard.

**Install dependencies**

```bash
pip install requests pandas scikit-learn
```

**Run**

```bash
python fpl_scout.py
```

This will print ranked recommendations to the terminal and save a file named `fpl_scout_gw<N>.csv` (where `<N>` is the next gameweek number) to the current directory.

---

## How the Algorithm Works

Each available player is scored using a **weighted sum of normalised features**. All features are scaled to 0–1 using min-max normalisation before being combined, so the weights are directly comparable regardless of the raw value ranges.

### Features & Default Weights

| Feature           | Default Weight | Description                                                                      |
| ----------------- | -------------- | -------------------------------------------------------------------------------- |
| Form (last 5 GWs) | 30%            | Average points per game over the last five gameweeks. Captures recent momentum.  |
| Points Per Game   | 25%            | Season-long PPG. Rewards consistent returners.                                   |
| Fixture Ease      | 20%            | Inverted FDR rating (5 − FDR). Higher = easier opponent.                         |
| xG+xA per 90      | 15%            | Expected goal involvements per 90 minutes. Predicts underlying attacking output. |
| ICT Index         | 10%            | FPL's combined Influence, Creativity, and Threat metric.                         |
| Bonus Points      | 8%             | Cumulative bonus awarded. Indicates consistent BPS involvement.                  |
| Low Ownership     | −5%            | Inverted ownership percentage. Negative weight rewards differentials.            |

### Scoring Formula

```
norm(x)  = (x − min) / (max − min)          # normalise each feature
score    = Σ ( weight_i × norm(feature_i) )  # weighted sum
score   *= 0.7  if minutes_pct < 0.60        # rotation risk penalty
score    = 0    if status ∉ {available}       # exclude unavailable players
```

The final score is multiplied by 100 and displayed as an integer in the dashboard.

### Adjusting Weights

In the dashboard, every weight has a slider in the **Algorithm Weights** panel at the top of the Recommendations tab. Changes take effect immediately — all 80+ visible players are re-ranked in real time without re-fetching any data.

In the Python script, edit the `WEIGHTS` dictionary near the top of `fpl_scout.py`:

```python
WEIGHTS = {
    "form":         0.30,
    "ppg":          0.25,
    "fixture_ease": 0.20,
    "xgi_per90":    0.15,
    "ict_index":    0.10,
    "bonus":        0.08,
    "ownership":   -0.05,
}
```

---

## FPL API Endpoints Used

| Endpoint                     | Used For                                             |
| ---------------------------- | ---------------------------------------------------- |
| `/api/bootstrap-static/`     | All player data, team list, gameweek events          |
| `/api/fixtures/`             | Full fixture list with FDR ratings per team          |
| `/api/element-summary/{id}/` | Per-player historical GW stats and upcoming fixtures |
| `/api/event/{gw}/live/`      | Live points for an in-progress gameweek              |

The bootstrap and fixtures endpoints are the only ones required for the recommendation algorithm. Element summaries are fetched optionally for deeper per-player breakdowns.

---

## CSV Format

The Python script exports a CSV with the following columns. The dashboard accepts all of these and will also tolerate common column name variations (e.g. `selected_by_percent` instead of `ownership`).

| Column        | Description                                                      |
| ------------- | ---------------------------------------------------------------- |
| `name`        | Player's display name                                            |
| `team`        | Short team name                                                  |
| `position`    | GK / DEF / MID / FWD                                             |
| `price`       | Current price (£m)                                               |
| `score`       | Scout score at time of export (0–100)                            |
| `ppg`         | Points per game                                                  |
| `form`        | FPL form rating                                                  |
| `fdr`         | Fixture difficulty rating for next GW (1–5)                      |
| `ownership`   | Percentage of FPL teams that own this player                     |
| `xgi_per90`   | Expected goal involvements per 90 minutes                        |
| `ict_index`   | ICT index                                                        |
| `bonus`       | Total bonus points this season                                   |
| `minutes_pct` | Fraction of available minutes played (used for rotation penalty) |
| `status`      | Availability status (`a` = available, `u` = uncertain, etc.)     |

When you load a CSV into the dashboard, the scores are **recalculated** using the current slider values rather than the pre-computed scores in the file, so you can freely adjust weights after loading.

---

## Dashboard Features

### Recommendations Tab

- Filter by position (All / GK / DEF / MID / FWD)
- Sort by Scout Score, Form, PPG, Price, Ownership, or Fixture Difficulty
- Click any player row to open a detail panel showing the score breakdown for each feature
- Data source badge in the status bar shows whether data came from the live API, a CSV file, or demo mode

### Algorithm Tab

Reference documentation explaining every feature, the scoring formula, and all API endpoints.

### Code Tab

The complete, runnable Python script displayed with syntax highlighting — copy it directly from the browser.

---

## Project Structure

```
fpl-recommender.html    # Self-contained dashboard (HTML + CSS + JS, no build step)
fpl_scout.py            # Python data-fetching and scoring script
README.md               # This file
fpl_scout_gw<N>.csv     # Output from fpl_scout.py (generated at runtime)
```

---

## Browser Compatibility

The dashboard uses standard ES2020 features (optional chaining, `AbortSignal.timeout`) and CSS custom properties. It works in all modern browsers. No build step, bundler, or server is required — just open the HTML file.

---

## Notes

- **CORS**: The FPL API does not send CORS headers, so direct browser requests are blocked. The dashboard automatically tries a list of public CORS proxies. If all fail, use the Python script to generate a CSV instead.
- **Injury / suspension**: Players with a status other than `available` or `uncertain` are excluded from results entirely.
- **Double gameweeks**: The algorithm currently scores for a single next gameweek. Players with a double gameweek will have a lower FDR on average but are not explicitly double-counted. You can account for this by temporarily increasing the Fixture Ease weight.
- **Blank gameweeks**: Players with no fixture in the next gameweek receive an FDR of 3 (neutral) by default. Filter them out manually by checking the Fixture column for a `—` indicator.
